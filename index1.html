<!DOCTYPE html>
<html>
<head>
    <title>Neo4j 可视化</title>
    <style>
        #viz {
            width: 100vw;
            height: 100vh;
            background: #000000;
        }
    </style>
</head>
<body>
    <div id="viz"></div>

    <script>
        window.onload = async function() {
            // 1. 创建driver连接数据库
            const driver = neo4j.driver(
                "bolt://localhost:7687",
                neo4j.auth.basic("neo4j", "LingLi051025"),
                { encrypted: 'ENCRYPTION_OFF' }
            );
            
            // 2. 执行查询获取数据
            const session = driver.session();
            const result = await session.run(`
                MATCH (n)-[r]->(m)
                RETURN n, r, m
                LIMIT 400
            `);
            await session.close();
            
            // 3. 设置不同标签的颜色
            const labelColors = {
                "Algorithm": "#FF6B6B",   // 红色
                "Category": "#4ECDC4",  // 青色
                "TimeComplexity": "#556270"   // 深蓝色
                // 添加更多标签颜色...
            };
            
            // 4. 处理数据
            const nodes = new vis.DataSet();
            const edges = new vis.DataSet();
            const nodeMap = {};
            
            result.records.forEach(record => {
                // 处理节点
                ['n', 'm'].forEach(key => {
                    const node = record.get(key);
                    const nodeId = node.identity.toString();
                    
                    if (!nodeMap[nodeId]) {
                        nodeMap[nodeId] = true;
                        
                        // 确定节点颜色
                        let color = "#C7D0D8"; // 默认颜色
                        for (const label of node.labels) {
                            if (labelColors[label]) {
                                color = labelColors[label];
                                break; // 使用第一个匹配的标签颜色
                            }
                        }
                        
                        nodes.add({
                            id: nodeId,
                            label: node.properties.name || node.labels[0],
                            title: JSON.stringify(node.properties, null, 2),
                            color: color
                        });
                    }
                });
                
                // 处理关系
                const rel = record.get('r');
                edges.add({
                    id: rel.identity.toString(),
                    from: rel.start.toString(),
                    to: rel.end.toString(),
                    label: rel.type,
                    color: "#C06C84", // 关系颜色
                    arrows: 'to'
                });
            });
            
            // 5. 渲染图形
            const container = document.getElementById('viz');
            const data = { nodes, edges };
            const options = {
                nodes: {
                    shape: "dot",
                    size: 20,
                    font: {
                        size: 14,
                        color: "#ffffff"
                    }
                },
                edges: {
                    width: 2,
                    font: {
                        size: 12,
                        color: "#ffffff"
                    }
                },
                physics: {
                    stabilization: true
                }
            };
            
            new vis.Network(container, data, options);
        };
    </script>
    
    <!-- 只需要引入这两个库 -->
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <script src="https://unpkg.com/neo4j-driver"></script>
</body>
</html>
